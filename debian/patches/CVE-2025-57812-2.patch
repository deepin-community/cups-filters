From 7bd588a1fc5c99ac0b1951beb1b54b438137a7b5 Mon Sep 17 00:00:00 2001
From: Till Kamppeter <till.kamppeter@gmail.com>
Date: Mon, 10 Nov 2025 18:44:59 +0100
Subject: [PATCH] Reject color images with 1 bit per sample

2. fix for CVE-2025-57812
---
 cupsfilters/image-tiff.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/cupsfilters/image-tiff.c b/cupsfilters/image-tiff.c
index 5eb29abc3..48fc8a28b 100644
--- a/cupsfilters/image-tiff.c
+++ b/cupsfilters/image-tiff.c
@@ -129,6 +129,15 @@ _cupsImageReadTIFF(
   if (!TIFFGetField(tif, TIFFTAG_BITSPERSAMPLE, &bits))
     bits = 1;
 
+  if (bits == 1 && samples > 1)
+  {
+    fprintf(stderr, "ERROR: Color images with 1 bit per sample not supported! "
+                    "Samples per pixel: %d; Bits per sample: %d\n", samples, bits);
+    TIFFClose(tif);
+    fclose(fp);
+    return (-1);
+  }
+
  /*
   * Get the image orientation...
   */
