From 95576ec3d20c109332d14672a807353cdc551018 Mon Sep 17 00:00:00 2001
From: Zdenek Dohnal <zdohnal@redhat.com>
Update-By: XiangZelong <xiangzelong@deepin.org>
Date: Fri, 27 Sep 2024 10:40:50 +0800
Subject: [PATCH] cfGetPrinterAttributes5(): Validate response attributes
 before return

The destination can be corrupted or forged, so validate the response
to strenghten security measures.

Fixes CVE-2024-47076
---
 cupsfilters/ipp.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/cupsfilters/ipp.c b/cupsfilters/ipp.c
index 5c53704..0d0216f 100644
--- a/cupsfilters/ipp.c
+++ b/cupsfilters/ipp.c
@@ -435,6 +435,14 @@ get_printer_attributes5(http_t *http_printer,
 	    ippDelete(response2);
 	  }
 	}
+
+  // Check if the response is valid
+  if (!ippValidateAttributes(response))
+	  {
+	    ippDelete(response);
+	    response = NULL;
+    }
+
 	if (have_http == 0) httpClose(http_printer);
 	if (uri) free(uri);
 	return response;
